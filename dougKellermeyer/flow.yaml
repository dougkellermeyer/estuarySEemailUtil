import:
- atlas1/flow.yaml
- snowflake-se-test-2/flow.yaml
collections:
  dougKellermeyer/moviesComments2:
    schema:
          type: object
          properties:
            comment_id:
              type: string
            movie_id:
              type: string 
            name:
              type: [string, "null"]
            email:
              type: [string, "null"]
            text:
              type: [string, "null"]
            created_at:
              type: [string, "null"]
            title:
              type: [string, "null"]
            year:
              type: [integer, string, "null"]
            plot:
              type: [string, "null"]
          required:
            - movie_id 
            - comment_id          
          reduce:
            strategy: merge
    key:
          - /comment_id           
    derive:
      using:
        sqlite:
          migrations:
          - moviesComments2.migration.0.sql
      transforms:
      - name: comments2
        source: dougKellermeyer/atlas1/sample_mflix/comments
        shuffle: any
        lambda: moviesComments2.lambda.comments2.sql
      - name: movies2
        source: dougKellermeyer/atlas1/sample_mflix/movies
        shuffle: any
        lambda: moviesComments2.lambda.movies2.sql
